<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>My movies</title>
        <script type="text/javascript" src="jquery-1.6.1.min.js"></script>
        <link rel="stylesheet" type="text/css" href="common.css"/>
        <link rel="stylesheet" type="text/css" href="themes/dark/style.css"/>
    </head>
    <body>
		<div class="sitecontainer">
			<div class="movies"></div>
			<div id="templates">
				<div class="movieclassic">
					<img class="cover" />
					<div class="content">
						<div class="title"></div>
						<div class="principals"></div>
						<div class="genres"></div>
						<div class="plot"></div>
						<span class="star hidden"></span>
						<a class="play">Play</a>
						<a class="showfiles"></a>
						<div class="files hidden"></div>
					</div>
                    <div class="clear"></div>
				</div>
			</div>
		</div>
        <script type="text/javascript">
            $(function () {
				//Usefull to test/edit layout
				var base = window.location.href.indexOf('file://') === 0
					? 'http://localhost:8080' : '';
                $.getJSON(base + '/*movies?jsonp=?', function (o) {
					var play = function(f){
						return $.get(base + '/*play', { f: f });
					};

                    var template = $('#templates .movieclassic');
					var t1 = $.now();
                    $.each(o, function () {
                        var m = this;
                        var e = template.clone();
                        $('.cover', e).attr('src', base + '/*scale/300x/' + (m.Cover ? 'covers/' + m.Cover : 'img/nocover.jpg'));
						var title = m.Title;
						if(m.Year)
							title += ' - ' + m.Year;
                        $('.title', e).text(title);
						$('.principals', e).text(m.Principals.join(' - '));
						$('.genres', e).text(m.Genres.join(' - '));
						$('.plot', e).text(m.Plot);
						if(m.ImdbRating)
							$('.star', e).removeClass('hidden').text(m.ImdbRating);
						var files = $('.files', e);
						
						$('.showfiles', e).text(m.Files.length + ' file' + (m.Files.length > 1 ? 's':'')).click(function(){
							if(files.is(':empty')){
								$.each(m.Files, function(i,v){
									$('<a/>').text(v).click(function(){
										play(v);
									}).appendTo(files);
								});
							}
							files.slideToggle(200);
						});
						
                        $('.play', e).click(function () {
                            play(m.Files[0]);
                        });
                        $('.movies').append(e);
                    });
					console.log('rendered ' + o.length + ' elements in ' + ($.now() - t1) + 'ms');
                });
            });
        </script>
    </body>
</html>
